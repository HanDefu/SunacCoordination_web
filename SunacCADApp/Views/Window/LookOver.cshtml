@{
    Layout = "~/Views/_LayoutPage.cshtml";
}
@using SunacCADApp.Entity
@using Common.Utility.Extender
@{
    CadDrawingMaster master = ViewBag.CadDrawingMaster;
    CadDrawingWindowDetail windowDetail = ViewBag.WindowDetail;
    int rowindex = 0;
    IList<CadDrawingDWG> Dwgs = ViewBag.Dwgs;
    CadDrawingDWG ExpansionDWG = Dwgs.Where(e => e.CADType == "ExpandViewFile").SingleOrDefault<CadDrawingDWG>();
    ExpansionDWG = ExpansionDWG == null ? new CadDrawingDWG() : ExpansionDWG;

    CadDrawingDWG VerticalDWG = Dwgs.Where(e => e.CADType == "FrontViewFile").SingleOrDefault<CadDrawingDWG>();
    VerticalDWG = VerticalDWG == null ? new CadDrawingDWG() : VerticalDWG;

    CadDrawingDWG PlanDWG = Dwgs.Where(e => e.CADType == "TopViewFile").SingleOrDefault<CadDrawingDWG>();
    PlanDWG = PlanDWG == null ? new CadDrawingDWG() : PlanDWG;

    CadDrawingDWG SideDWG = Dwgs.Where(e => e.CADType == "LeftViewFile").SingleOrDefault<CadDrawingDWG>();
    SideDWG = SideDWG == null ? new CadDrawingDWG() : SideDWG;

    string imagePath = string.IsNullOrEmpty(ExpansionDWG.DWGPath) ? "/Content/Css/img/icon-no-image.png" : ExpansionDWG.DWGPath;
    string cadName = string.IsNullOrEmpty(ExpansionDWG.FileClass) ? string.Empty : ExpansionDWG.FileClass;
}
<div class="row topnav">
    <a>标准部品库</a>
    <i></i>
    <a href="/Window">外窗</a>
    <i></i>
    <a>@master.DrawingCode</a>
    @if (master.Enabled == 0)
    {
        <span class="check-state state-unchecked">草稿</span>
    }
    else if (master.Enabled == 1)
    {
        <span class="check-state state-unchecked">待审核</span>
    }
    else if (master.Enabled == 2)
    {
        <span class="check-state state-unchecked">已发布</span>
    }

</div>
<div class="row view">
    <div class="left-column">
        <figure class="icon-drawing-img">
            <img src="@imagePath" width="238" heigth="200" />
            <p>@cadName</p>
        </figure>
    </div>
    <div class="mian-column">
        <dl>
            <dt class="col-dt"><i></i>原型编号：</dt>
            <dd>
                @master.DrawingCode
            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>展开图文件：</dt>
            <dd>
                <input type="text" style="width:378px" disabled="disabled" name="txt_filename" value="@ExpansionDWG.FileClass" placeholder="展开图文件" class="required" data-error="展开图文件不能为空" />
                <input type="hidden" name="txt_drawingcad" value="@ExpansionDWG.CADPath" />
                <input type="hidden" name="hid_drawing_img" value="@ExpansionDWG.DWGPath" />
                <input type="hidden" name="hid_drawing_type" value="ExpansionView" />
                <a class="btn-upfile  download-upfile" data-src="@ExpansionDWG.CADPath">原型图纸下载</a>
            </dd>
        </dl>

        <dl>
            <dt class="col-dt"><i></i>立面图文件：</dt>
            <dd>
                <input type="text" style="width:378px" disabled="disabled" name="txt_filename" value="@VerticalDWG.FileClass" placeholder="立面图文件" class="required" data-error="立面图文件不能为空" />
                <input type="hidden" name="txt_drawingcad" value="@VerticalDWG.CADPath" />
                <input type="hidden" name="hid_drawing_img" value="@VerticalDWG.DWGPath" />
                <input type="hidden" name="hid_drawing_type" value="VerticalView" />
                <a class="btn-upfile  download-upfile" data-src="@VerticalDWG.CADPath">原型图纸下载</a>
            </dd>
        </dl>

        <dl>
            <dt class="col-dt"><i></i>平面图文件：</dt>
            <dd>
                <input type="text" style="width:378px" disabled="disabled" name="txt_filename" value="@PlanDWG.FileClass" placeholder="平面图文件" class="required" data-error="平面图文件不能为空" />
                <input type="hidden" name="txt_drawingcad" value="@PlanDWG.CADPath" />
                <input type="hidden" name="hid_drawing_img" value="@PlanDWG.DWGPath" />
                <input type="hidden" name="hid_drawing_type" value="PlanView" />
                <a class="btn-upfile  download-upfile" data-src="@PlanDWG.CADPath">原型图纸下载</a>
            </dd>
        </dl>

        <dl>
            <dt class="col-dt"><i></i>侧面图文件：</dt>
            <dd>
                <input type="text" style="width:378px" disabled="disabled" name="txt_filename" value="@SideDWG.FileClass" placeholder="侧面图文件" />
                <input type="hidden" name="txt_drawingcad" value="@SideDWG.CADPath" />
                <input type="hidden" name="hid_drawing_img" value="@SideDWG.DWGPath" />
                <input type="hidden" name="hid_drawing_type" value="SideView" />
                <a class="btn-upfile  download-upfile" data-src="@SideDWG.CADPath">原型图纸下载</a>
            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>使用范围：</dt>
            <dd style="width:500px;">
                <span style="display:block;padding-top:5px;line-height:35px;">
                    @foreach (CadDrawingByArea Area in ViewBag.ByAreas)
                    {
                        <span class="online-checkbox">
                            <label>@Area.AreaName</label>
                        </span>
                    }
                </span>

            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>模块类型：</dt>
            <dd>
                @if (master.DynamicType == 1)
                {
                    <span class="online-checkbox">
                        <label for="radio_dynamic_module">动态模型</label>
                    </span>
                }
                else
                {
                    <span class="online-checkbox">
                        <label for="radio_static_module">静态模型</label>
                    </span>
                }

            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>功能区类型：</dt>
            <dd style="width:500px;">
                <span style="display:block;padding-top:5px;line-height:35px;">
                    @foreach (CadDrawingFunction Fun in ViewBag.Functions)
                    {
                        <span class="online-checkbox">
                            <label for="actiontype_all">@Fun.FunctionName</label>
                        </span>
                    }


                </span>
            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>开启类型：</dt>
            <dd>
                @windowDetail.WindowOpenTypeName
            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>开启扇数量：</dt>
            <dd>
                @windowDetail.WindowOpenQtyName
                扇
            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>是否对称窗型：</dt>
            <dd>
                @{
                    string WindowHasCorner = windowDetail.WindowHasCorner == 0 ? "否" : "是";
                }
                @WindowHasCorner

            </dd>
        </dl>
        <dl>
            <dt class="col-dt"><i></i>是否转角窗型：</dt>
            <dd>
                @{
                    string WindowHasSymmetry = windowDetail.WindowHasSymmetry == 0 ? "否" : "是";
                }
                @WindowHasSymmetry
            </dd>
        </dl>
        @if (master.DynamicType == 1)
        {
            <dl>
                <dt class="col-dt"><i></i>宽度尺寸范围（mm）：</dt>
                <dd>
                    @Decimal.ToInt32(windowDetail.WindowSizeMin)
                    <i> - &nbsp; </i>
                    @Decimal.ToInt32(windowDetail.WindowSizeMax)

                </dd>
            </dl>
            <dl>
                <dt class="col-dt"><i></i>通风量计算公式：</dt>
                <dd>
                    @windowDetail.WindowDesignFormula
                </dd>
            </dl>
            <dl>
                <dt class="col-dt"><i></i>参数取值：</dt>
            </dl>
            <dl>
                <dd>
                    <table class="table table-bordered param" style="margin-left:60px;margin-right:60px; width:720px;">
                        <thead>
                            <tr>
                                <th width="80" class="text-center">尺寸代码</th>
                                <th width="70" class="text-center">值类型</th>
                                <th width="70" class="text-center">最大值</th>
                                <th width="70" class="text-center">最小值</th>
                                <th width="200" class="text-center">值</th>
                                <th width="60" class="text-center">默认值</th>
                                <th class="text-center">说明</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (CadDrawingParameter param in ViewBag.CadDrawingParams)
                            {
                                string strMinValue = param.MinValue > 0 ? param.MinValue.ConventToString(string.Empty) : string.Empty;
                                string strMaxValue = param.MaxValue > 0 ? param.MaxValue.ConventToString(string.Empty) : string.Empty;
                                string strDefaultValue = param.DefaultValue > 0 ? param.DefaultValue.ConventToString(string.Empty) : string.Empty;
                                <tr sizeno="@param.SizeNo">
                                    <td class="text-center">@param.SizeNo</td>
                                    <td valign="middle">
                                        <input type="text" class="input-val" name="Val" disabled="disabled" value="@param.ValueTypeName" />
                                    </td>
                                    <td class="value"><input type="text" class="input-minvalue" name="MinValue" disabled="disabled" value="@strMinValue" /></td>
                                    <td class="value"><input type="text" class="input-maxvalue" name="MaxValue" disabled="disabled" value="@strMaxValue" /></td>
                                    <td class="value"><input type="text" class="input-val" name="Val" disabled="disabled" value="@param.Val" /></td>
                                    <td class="value"><input type="text" class="input-defaultvalue" name="DefaultValue" disabled="disabled" value="@strDefaultValue" /></td>
                                    <td class="desc"><input type="text" class="input-desc" name="Desc" value="@param.Desc" /></td>
                                </tr>
                            }


                        </tbody>
                    </table>
                </dd>
            </dl>
        }
        else
        {
            <dl>
                <dt class="col-dt"><i></i>尺寸（mm）：</dt>
                <dd>
                    <em>宽:</em>
                    @Decimal.ToInt32(windowDetail.WindowSizeMin)
                    mm
                    <i>-&nbsp;</i>
                    <em>高 :</em>
                    @Decimal.ToInt32(windowDetail.WindowSizeMax)
                    mm
                </dd>
            </dl>
            <dl>
                <dt class="col-dt"><i></i>通风量：</dt>
                <dd>
                    @windowDetail.WindowVentilationQuantity
                </dd>
            </dl>
            <dl>
                <dt class="col-dt"><i></i>塞缝尺寸：</dt>
                <dd>
                    @windowDetail.WindowPlugslotSize

                </dd>
            </dl>
            <dl>
                <dt class="col-dt">是否有附框：</dt>
                <dd>
                    @{string WindowAuxiliaryFrame = windowDetail.WindowAuxiliaryFrame == 0 ? "否" : "是";}
                    @WindowAuxiliaryFrame
                </dd>
            </dl>
        }
        <div class="row" style="margin-bottom:20px;padding-left:58px;padding-right:57px;">
            <div class="col-md-6 col-sm-6">
            </div>
            <div class="col-md-6 col-sm-6" style="text-align:right;">
                <a class="btn btn-sunac" id="btn_save" href="/Window/Edit/@master.Id"> 编辑</a>
                <button type="button" class="btn btn-sunac btn-delete" data-id="@master.Id">删除</button>
                <button type="button" class="btn btn-sunac">提交审核</button>
            </div>
        </div>
    </div>

</div>

<script type="text/javascript">
    $(function () {
        $(".btn-delete").on("click", function () {
            let Id = $(this).data("id");
            layer.confirm('是否需要删除', {
                btn: ['删除', '取消'],
                shade: false,
                icon: 3
            }, function () {
                $.post("/window/deleteHandlebyid", { Id: Id }, function (data) {
                    if (data.code == 100) {
                        layer.alert("删除成功", { icon: 6, shade: false }, function () {
                            window.location.href = "/window/index";
                        })
                    } else {
                        layer.alert("删除失败", { icon: 6, shade: false });
                    }
                }, 'json');
            });

        })

    })
</script>


