@using SunacCADApp.Entity;
@using SunacCADApp.Data;
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <link href="~/Content/Css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/Css/sunac.css" rel="stylesheet" />
    <link href="~/Content/Plugins/mtips/mTips.css" rel="stylesheet" />
    <script src="~/Content/Js/jquery-1.12.4.min.js" type="text/javascript"></script>
    <script src="~/Content/Js/jquery.form.js" type="text/javascript"></script>
    <script src="~/Content/Js/goyeer.validation.js" type="text/javascript"></script>
    <script src="~/Content/Plugins/layer/layer.js" type="text/javascript"></script>
    <script src="~/Content/Plugins/laydate/laydate.js" type="text/javascript"></script>
    <script src="~/Content/Plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="~/Content/Plugins/mtips/mTips.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function () {
            let win_height = $(window).height();
            console.log(win_height);
            $('.mian-column').css("min-height", (win_height - 130));
            $('.center').css("min-height", (win_height - 70));
            $(".btn-upfile  .upload-cad").on("change", function () {
                let file_info = $(this).val();
                let that = $(this);
                let parent = $(this).parent().parent();
                if (_isNull(file_info)) {
                    layer.msg("上传文件不能为空", { icon: 5 });
                    return;
                }
                var img_ext = file_info.substr(file_info.length - 4, 4);
                if (img_ext != ".dwg") {
                    layer.msg("上传文件格式不正确", { icon: 5 });
                    return;
                }
                var formData = new FormData();
                formData.append("file", that[0].files[0]);
                $.ajax({
                    url: '/CommonLib/UpFile', /*接口域名地址*/
                    type: 'post',
                    data: formData,
                    contentType: false,
                    processData: false,
                    dataType: 'json',
                    success: function (res) {
                        if (res.Code == 100) {
                            let cad_file = res.CadPath;
                            let img_file = res.ImgPath;
                            let file_name = res.FileName;
                            parent.find('input[name="txt_filename"]').val(file_name);
                            parent.find('input[name="txt_drawingcad"]').val(cad_file);
                            parent.find('input[name="hid_drawing_img"]').val(img_file);
                            $('.icon-drawing-img  img').attr("src", img_file);
                            $('.icon-drawing-img  p').text(file_name);
                        } else {
                            layer.alert(res.Message, { icon: 5 })
                        }
                    }
                })
            })

            $(".select-all").on("change", function () {
                let that = $(this).parent().parent();
                that.find(".single-checkbox").prop("checked", $(this).prop("checked"));
            })

            $('input[name="txt_filename"]').on('click', function () {
                let cadpath = $(this).val();
                let drawing_img = $(this).siblings('input[name="hid_drawing_img"]').val();
                if (!_isNull(cadpath)) {
                    $('.icon-drawing-img  img').attr("src", drawing_img);
                    $('.icon-drawing-img  p').text(cadpath);
                }
            })

            $('.download-upfile').on('click', function () {
                let upfile = $(this).data("src");
                let filename = $(this).data("filename");
                if (_isNull(upfile)) {
                    layer.alert("没有你要下载的文件", { icon: 5, shade: 0 });
                    return;
                }
                window.location.href = "/CommonLib/DownFile?file=" + upfile + "&filename=" + filename;
            })

            $(".icon-tips").on("mouseenter", function () {
                let tips = $(this).attr("tips");
                mTips.s(tips, 'sunac');
            })

            $('.icon-tips').on('mouseleave', function (e) {
                mTips.h();
            })
        });
    </script>
</head>
<body>
    <div class="container-fluid">
        <header> </header>
        <div class="main">
            <div class="leftsidebar">
                @{
                    IList<Sys_Model> models = Sys_ModelDB.GetSysModeByRoleID(-8888);
                }
                @foreach (Sys_Model m in models)
                {
                    if (m.Parent_ID == 0 && m.IsPower == "1")
                    {


                        <dl>
                            @if (m.Id == 3)
                            {
                        
                                <dt class="@m.Model_ICON">
                                    <a href="@m.Model_URL">@m.Model_Name</a>
                                </dt>
                            }
                            else
                            {
                                <dt class="@m.Model_ICON">
                                    <a class="down">@m.Model_Name</a>
                                </dt>
                                <dd>
                                    @foreach (Sys_Model sub in models)
                                    {
                                        if (sub.Parent_ID == m.Id)
                                        {
                                            if (ViewBag.SelectModel == sub.Id)
                                            {
                                                <a href="@sub.Model_URL" class="selected">@sub.Model_Name</a>
                                            }
                                            else
                                            {
                                                <a href="@sub.Model_URL">@sub.Model_Name</a>
                                            }

                                        }
                                    }


                                </dd>
                            }

                        </dl>
                    }

                }
            </div>
            <div class="center">
                @RenderBody()
            </div>

        </div>

    </div>

</body>
</html>
